AGEN CORE RULES (v1.0)

Intended Audience: AI/LLM
Purpose: Quick reference for framework modification decisions
Full Details: guidelines/references/

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
IMMUTABLE ARCHITECTURE PRINCIPLES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. CELLS-FIRST DESIGN
   âœ“ Agents are leaves, not roots
   âœ“ Compose capabilities via cells (YAML pipelines)
   âœ— Never create monolithic agents

   Details: guidelines/references/architecture.md

2. ZERO EXTERNAL DEPENDENCIES (atomic/)
   âœ“ atomic/ must remain stdlib-only
   âœ“ Foundation for VFS, VCR - cannot break
   âœ— Adding deps to atomic/ breaks entire framework

   Details: guidelines/references/architecture.md

3. THREE-METHOD AGENT INTERFACE
   âœ“ Initialize(support.ServiceRegistry) error
   âœ“ ProcessEnvelope(context.Context, *envelope.Envelope) error
   âœ“ Shutdown() error
   âœ— No other methods required - framework handles infrastructure

   Details: guidelines/references/agent-patterns.md

4. STANDARD CONFIGURATION RESOLUTION
   âœ“ All binaries follow 7-level resolution:
     1. --config flag
     2. AGEN_CONFIG_PATH env
     3. AGEN_WORKBENCH_DIR/config/agents/<name>.yaml
     4. ./config/<name>.yaml
     5. ./workbench/config/agents/<name>.yaml
     6. <binary-dir>/config/<name>.yaml
     7. Embedded defaults
   âœ“ Use agent.NewStandardConfigResolver()
   âœ— Never hardcode config paths

   Details: guidelines/references/config-standards.md

5. VFS ISOLATION
   âœ“ Project context = workbench/projects/<name>/ ONLY
   âœ“ Workbench context = workbench/config/, workbench/demos/
   âœ“ Framework context = full repo (self-modification)
   âœ— Never mix contexts -ä¸¥é‡å®‰å…¨é—®é¢˜

   Details: guidelines/references/architecture.md

6. VCR THREE-TIER SYSTEM
   âœ“ Framework VCR = agen/.git (code changes)
   âœ“ Workbench VCR = workbench/.git (config/demos)
   âœ“ Project VCR = projects/<name>/.git (user code)
   âœ“ Backups = .git-remotes/<name>.git (recovery)
   âœ— Never commit across VCR boundaries

   Details: guidelines/references/architecture.md

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DECISION TREE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CAN I ADD A NEW AGENT?
  âœ“ YES
  â†’ Read guidelines/references/agent-patterns.md
  â†’ Use 3-method interface
  â†’ Add to workbench/config/pool.yaml
  â†’ Follow StandardConfigResolver
  â†’ Include embedded defaults

CAN I MODIFY atomic/?
  âš ï¸  EXTREME CAUTION
  â†’ MUST remain zero external dependencies
  â†’ Read guidelines/references/architecture.md
  â†’ Understand impact on VFS/VCR
  â†’ Test extensively

CAN I CHANGE CONFIGURATION RESOLUTION?
  âœ— NO - Standardized across all binaries
  â†’ If improving: Update cellorg/public/agent/config.go
  â†’ All agents automatically benefit

CAN I ADD EXTERNAL DEPENDENCY?
  âœ“ YES in: agents/, cellorg/, omni/, alfa/
  âœ— NO in: atomic/
  â†’ Use go.mod in appropriate module
  â†’ Update go.work if needed

CAN I CREATE A NEW MODULE?
  âœ“ YES
  â†’ Read guidelines/references/architecture.md
  â†’ Follow module layering (atomic â†’ omni â†’ cellorg â†’ agents)
  â†’ Create go.mod
  â†’ Add to go.work
  â†’ Document in module's README.md

CAN I MODIFY ALFA (AI WORKBENCH)?
  âš ï¸  REQUIRES APPROVAL
  â†’ Core runtime changes need human review
  â†’ Tools, actions = OK
  â†’ System prompt changes = OK
  â†’ Architecture changes = ASK FIRST

CAN I CHANGE CELL ORCHESTRATION?
  âš ï¸  REQUIRES APPROVAL
  â†’ Core pattern is fundamental to AGEN
  â†’ Read guidelines/references/architecture.md
  â†’ Discuss before implementing

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MANDATORY CHECKS BEFORE COMMIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PRE-COMMIT CHECKLIST:
  â–¡ Code compiles (go build succeeds)
  â–¡ Tests written for new functionality
  â–¡ All tests pass (go test ./...)
  â–¡ Follows 3-method pattern (if agent)
  â–¡ Uses StandardConfigResolver (if new binary)
  â–¡ Updated relevant README.md
  â–¡ No new dependencies in atomic/
  â–¡ VFS isolation maintained
  â–¡ Configuration follows 7-level resolution
  â–¡ Embedded defaults provided (if binary)

COMMIT MESSAGE FORMAT:
  - Be descriptive and concise
  - Include "Fix:", "Add:", "Update:" prefix
  - Add ğŸ¤– Generated with Claude Code footer
  - Use Co-Authored-By: Claude <noreply@anthropic.com>

VERSIONING:
  <major>.<feature>.<patch>
  - major: Only with explicit approval
  - feature: New agents, cells, modules
  - patch: Bug fixes, tests, docs

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
COMMON PATTERNS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CREATING AN AGENT:
  1. Read guidelines/references/agent-patterns.md
  2. Create code/agents/<name>/main.go
  3. Implement 3 methods
  4. Add StandardConfigResolver
  5. Provide embedded defaults
  6. Add to workbench/config/pool.yaml
  7. Write tests
  8. Build and test

MODIFYING FRAMEWORK:
  1. Read guidelines/references/architecture.md
  2. Verify compliance with principles
  3. Check module layering
  4. Run all tests
  5. Update documentation
  6. Commit with clear message

ADDING CONFIGURATION:
  1. Read guidelines/references/config-standards.md
  2. Place in workbench/config/ or workbench/config/agents/
  3. Document in workbench/config/README.md
  4. Provide embedded defaults in binary
  5. Test all 7 resolution levels

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DETAILED REFERENCES (Use read_file)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Architecture & Principles:
  guidelines/references/architecture.md
  - Module layering
  - Zero-dep requirement
  - VFS/VCR systems
  - Cells-first design

Agent Development:
  guidelines/references/agent-patterns.md
  - 3-method interface details
  - Storage patterns
  - Configuration examples
  - Testing patterns

Configuration Standards:
  guidelines/references/config-standards.md
  - 7-level resolution details
  - Directory structure
  - Environment variables
  - StandardConfigResolver implementation

Testing Patterns:
  guidelines/references/testing.md
  - Test organization
  - Coverage requirements
  - Integration tests
  - CI/CD patterns

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CRITICAL REMINDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸  BEFORE ANY FRAMEWORK MODIFICATION:
   Use read_file to consult the relevant reference guide

âš ï¸  WHEN IN DOUBT:
   Read guidelines/references/architecture.md

âš ï¸  BREAKING THESE RULES:
   Will likely break the framework or violate design principles

âœ“  THESE RULES EXIST TO:
   Maintain architectural integrity during self-modification
